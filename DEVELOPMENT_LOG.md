# 『一瞥』開発ログ

## 2025年1月4日 - 開発方針の重要な変更

### 背景
- PlanetScaleが有料のためクレジットカード登録が必要
- NextAuth.jsの複雑な認証設定でエラーが発生
- 開発効率を優先し、MVPの核心機能に集中する必要性

### 技術的決定事項

#### 1. データベース変更
- **変更前**: PlanetScale (MySQL)
- **変更後**: SQLite (開発用)
- **理由**: 無料、設定不要、ローカル開発に最適
- **本番移行**: 後でSupabase/Railway/Neonに移行予定

#### 2. 認証機能の簡素化
- **変更前**: NextAuth.js + データベースセッション + 匿名ユーザー自動作成
- **変更後**: 固定匿名ユーザー（開発用）
- **理由**: NextAuth.jsのCredentials + Database戦略でエラー発生
- **実装**: `useAuth()`フックで固定ユーザーID返却

```typescript
// 開発用の簡素化された認証
export function useAuth() {
  const [userId] = useState(() => `dev_user_${Date.now()}`)
  return {
    user: { id: userId, name: "開発用ユーザー" },
    userId: userId,
    isLoading: false,
    isAuthenticated: true,
  }
}
```

#### 3. 画像ストレージの後回し
- **変更前**: Vercel Blob Storage
- **変更後**: 開発段階では未実装、後でCloudinary等を検討
- **理由**: 有料サービスのため開発段階では不要

### 段階的開発計画

#### Phase 1: コア機能開発（現在）
1. ✅ プロジェクト基盤構築
2. ✅ データベース設定（SQLite）
3. ✅ 認証機能簡素化
4. 🔄 API Routes実装
5. 🔄 フロントエンドUI実装

#### Phase 2: 機能拡張
1. 本格的な認証機能実装
2. 画像アップロード機能
3. 本番データベース移行

#### Phase 3: 本番デプロイ
1. 本番環境構築
2. パフォーマンス最適化
3. セキュリティ強化

### 設計書への反映
- `design.md`に開発段階での技術的決定事項を追記
- 認証機能の段階的実装計画を明記
- データベース選択肢の整理

### 利点
1. **開発速度向上**: 複雑な設定に時間を取られない
2. **コスト削減**: 開発段階では無料ツールのみ使用
3. **段階的実装**: 核心機能を先に完成させる
4. **柔軟性**: 後から最適な技術選択が可能

### 次のステップ
- タスク3.1「店舗一覧取得API実装」に進む
- SQLiteデータベースを使用したAPI開発
- 固定匿名ユーザーでのフロントエンド開発

この方針変更により、開発効率を大幅に向上させ、MVPの完成を早めることを目指す。