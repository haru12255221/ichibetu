# 『一瞥』実装タスクリスト（MVP版 - Next.js構成）

## 1. プロジェクト基盤構築

- [ ] 1.1 Next.js プロジェクト初期化
  - Next.js 13 プロジェクトの作成（App Router使用）
  - TypeScript, Tailwind CSS, ESLint の設定
  - 必要なライブラリのインストール（Framer Motion, Prisma, NextAuth.js, @vercel/blob）
  - PWA設定（next-pwa）
  - _要件: 要件6.1, 要件6.2_

- [ ] 1.2 プロジェクト構造とツール設定
  - App Routerディレクトリ構造の構築（app/, components/, lib/, types/）
  - Prismaの初期化とスキーマファイル作成
  - NextAuth.js設定ファイル作成
  - 環境変数設定（.env.local）
  - _要件: 全要件の基盤_

## 2. データベース・認証基盤実装

- [ ] 2.1 PlanetScale データベース設定
  - PlanetScaleアカウント作成とデータベース作成
  - Prismaスキーマの実装（Restaurant, User, Favorite モデル）
  - データベース接続設定とPrismaクライアント設定
  - マイグレーション実行とスキーマ同期
  - _要件: 要件3.1, 要件4.1, 要件4.4_

- [ ] 2.2 NextAuth.js認証システム実装
  - NextAuth.js設定ファイル（app/api/auth/[...nextauth]/route.ts）
  - セッションベース認証の実装（匿名ユーザー対応）
  - ミドルウェア設定（middleware.ts）
  - セッション管理とユーザー識別システム
  - _要件: 要件5.1, 要件5.2, 要件5.3_

## 3. 店舗関連API Routes実装

- [ ] 3.1 店舗一覧取得API実装
  - app/api/restaurants/route.ts（GET）の実装
  - Prismaを使用した店舗データ取得ロジック
  - ランダム順表示とアクティブ店舗フィルタリング
  - レスポンス形式の統一とエラーハンドリング
  - _要件: 要件1.1, 要件1.3_

- [ ] 3.2 店舗詳細取得API実装
  - app/api/restaurants/[id]/route.ts（GET）の実装
  - 動的ルートパラメータの処理
  - 店舗詳細情報の取得とレスポンス
  - 存在しない店舗IDのエラーハンドリング
  - _要件: 要件2.1, 要件2.2_

- [ ] 3.3 店舗登録API実装
  - app/api/restaurants/route.ts（POST）の実装
  - Vercel Blob Storageを使用した画像アップロード
  - FormDataの処理と入力値バリデーション
  - Prismaを使用したデータベース保存
  - _要件: 要件4.1, 要件4.2, 要件4.3, 要件4.4_

## 4. お気に入り機能API Routes実装

- [ ] 4.1 お気に入り追加API実装
  - app/api/favorites/route.ts（POST）の実装
  - NextAuth.jsセッションからのユーザー識別
  - Prismaを使用した重複チェックとデータ保存
  - エラーハンドリングとレスポンス処理
  - _要件: 要件1.2, 要件3.1_

- [ ] 4.2 お気に入り一覧取得API実装
  - app/api/favorites/route.ts（GET）の実装
  - セッションユーザーのお気に入り取得
  - Prisma includeを使用した店舗情報結合
  - 作成日時順ソートとレスポンス形式統一
  - _要件: 要件3.1, 要件3.2_

- [ ] 4.3 お気に入り削除API実装
  - app/api/favorites/[id]/route.ts（DELETE）の実装
  - ユーザー権限チェック（自分のお気に入りのみ削除）
  - Prismaを使用した安全な削除処理
  - 削除成功レスポンスの返却
  - _要件: 要件3.3_

## 5. フロントエンド基盤実装

- [ ] 5.1 App Routerレイアウトとナビゲーション設定
  - app/layout.tsx でのルートレイアウト実装
  - Next.js App Routerによる画面遷移設定
  - PWA設定（next-pwa, manifest.json）
  - Tailwind CSS グローバルスタイル設定
  - _要件: 要件6.1, 要件6.2_

- [ ] 5.2 共通コンポーネントとUI実装
  - components/ui/ 配下の基本コンポーネント
  - ローディング・エラー表示コンポーネント
  - 画像表示コンポーネント（Next.js Image最適化）
  - ボタン・フォームコンポーネント
  - _要件: 要件6.3_

- [ ] 5.3 データフェッチングとセッション管理
  - SWRまたはTanStack Queryによるデータ管理
  - カスタムフック（useRestaurants, useFavorites）実装
  - NextAuth.jsセッション管理とuseSession
  - エラーハンドリングとローディング状態管理
  - _要件: 全API関連要件_

## 6. メインスワイプ画面実装

- [ ] 6.1 スワイプカードコンポーネント実装
  - Framer Motion を使用したカードコンポーネント作成
  - 全画面画像表示機能
  - オーバーレイテキスト（店主の一言）表示
  - 画像読み込みエラー時の代替表示
  - _要件: 要件1.1, 要件1.5_

- [ ] 6.2 4方向スワイプジェスチャー実装
  - 左右スワイプの認識と処理（左：次へ、右：お気に入り追加）
  - 上下スワイプの認識と処理（上：詳細画面、下：お気に入りリスト）
  - スワイプ方向の判定ロジック（水平・垂直の優先度）
  - スワイプアニメーション（カード移動、フェード効果）
  - スワイプ閾値と速度の調整
  - _要件: 要件1.2, 要件1.3, 要件1.4, 要件1.5_

- [ ] 6.3 メイン画面統合とナビゲーション
  - 4方向スワイプによる画面遷移の統合
  - 下スワイプでお気に入りリスト表示の実装
  - 店舗データの無限スクロール的な読み込み
  - 画像の事前読み込み最適化
  - スワイプ方向のビジュアルフィードバック
  - _要件: 要件1.5, 要件3.4, 要件6.2, 要件6.3_

## 7. 店舗詳細画面実装

- [ ] 7.1 ストーリー詳細画面レイアウト実装
  - 店舗詳細情報の表示レイアウト
  - メイン画像の表示
  - 基本情報（店名、住所、営業時間）の表示
  - 店主の物語テキストの表示
  - _要件: 要件2.1, 要件2.2_

- [ ] 7.2 詳細画面ナビゲーション実装
  - 戻るボタンの実装
  - お気に入り追加ボタンの実装
  - 画面遷移アニメーション
  - お気に入り状態の表示切り替え
  - _要件: 要件2.4, 要件3.1_

- [ ] 7.3 詳細画面とAPI連携
  - 店舗詳細データの取得と表示
  - お気に入り追加/削除機能の実装
  - エラーハンドリング（店舗が見つからない場合等）
  - ローディング状態の表示
  - _要件: 要件2.1, 要件2.2, 要件2.3_

## 8. お気に入りリスト画面実装

- [ ] 8.1 お気に入りリスト表示実装
  - 下スワイプによるお気に入りリスト表示
  - 店舗カード形式での表示（画像、店名、一言）
  - 空のリスト時の表示
  - リストアイテムのタップによる詳細画面遷移
  - 上スワイプまたは戻るボタンでメイン画面復帰
  - _要件: 要件1.5, 要件3.1, 要件3.2, 要件3.4_

- [ ] 8.2 お気に入り管理機能実装
  - お気に入り削除機能（スワイプまたはボタン）
  - 削除確認ダイアログ
  - リストの動的更新
  - 削除アニメーション
  - _要件: 要件3.3_

## 9. 店舗登録画面実装

- [ ] 9.1 店舗登録フォーム実装
  - 画像アップロード機能（ドラッグ&ドロップ対応）
  - 基本情報入力フォーム（店名、住所、営業時間、電話番号）
  - 店主の一言入力フィールド
  - 店舗の物語入力テキストエリア
  - _要件: 要件4.1, 要件4.2, 要件4.3, 要件4.4_

- [ ] 9.2 フォームバリデーションと送信処理
  - 入力値のリアルタイムバリデーション
  - 画像ファイルの形式・サイズチェック
  - フォーム送信処理とAPI連携
  - 送信中のローディング表示と成功/エラー表示
  - _要件: 要件4.1, 要件4.2, 要件4.3, 要件4.4, 要件4.5_

## 10. 最終統合とデプロイ

- [ ] 10.1 統合テストとE2Eテスト
  - 全画面の遷移フローテスト
  - スワイプ→詳細→お気に入り追加の一連の流れテスト
  - 店舗登録→表示確認の流れテスト
  - Next.js App Routerナビゲーションの確認
  - _要件: 全要件の統合_

- [ ] 10.2 パフォーマンス最適化とPWA対応
  - Next.js Image最適化の確認
  - Core Web Vitalsの測定と改善
  - PWA機能（オフライン対応、ホーム画面追加）の動作確認
  - モバイルデバイスでのタッチ操作最適化
  - _要件: 要件6.1, 要件6.2, 要件6.3_

- [ ] 10.3 Vercelデプロイと本番環境構築
  - PlanetScaleデータベースの本番環境設定
  - Vercel環境変数の設定（DATABASE_URL, NEXTAUTH_SECRET等）
  - Vercel Blob Storageの設定
  - 本番デプロイとドメイン設定
  - 本番環境での動作確認とパフォーマンステスト
  - _要件: 全要件の本番環境での動作_